{%- comment -%}
------------------------------------------------------------------------------
	Section: Featured collections
------------------------------------------------------------------------------
{%- endcomment -%}

{%- render 'adastra' with '/src/styles/carousel.scss' -%}
{%- render 'adastra' with '/src/styles/featured-products.scss' -%}

{%- style -%}
	#shopify-section-{{- section.id -}} {
		padding-top: {{- section.settings.offset_top_mobile -}}px;
		padding-bottom: {{- section.settings.offset_bottom_mobile -}}px;
	}

	@media screen and (min-width: 768px) {
		#shopify-section-{{- section.id -}} {
			padding-top: {{- section.settings.offset_top_desktop -}}px;
			padding-bottom: {{- section.settings.offset_bottom_desktop -}}px;
		}
	}
{%- endstyle -%}

{%- assign heading = section.settings.heading -%}
{%- assign layout = section.settings.layout -%}
{%- assign show_arrows = section.settings.show_arrows -%}
{%- assign collection_list = section.settings.collection_list -%}
{%- assign container = section.settings.container_width -%}

{% if container == 'inherit' %}
	{% assign container_width = settings.container_width %}
{% else %}
	{% assign container_width = container %}
{% endif %}

{%- capture featured_products_row_wrapper_classes -%}
	featured-products__slider swiper need-animate tr-dur-0-8 {{-  -}}
	{% if collection_list.size > 1 or collection_list == blank %} js-featured-products-slider {{-  -}} {%- endif -%}
{%- endcapture -%}

<section class="featured-products js-featured-products js-animate {% if request.visual_preview_mode or section.index == 1 %}animated{% endif %}" id="{{- section.id -}}" style="--container-width: {{ container_width }};">
	<div class="featured-products__container">
		{%- if heading != blank -%}
			<h2 class="featured-products__heading h2 need-animate tr-dur-0-8">
				{{- heading -}}
			</h2>
		{%- endif -%}

		<div class="featured-products__content-wrapper">
			<div class="{{- featured_products_row_wrapper_classes | strip_newlines -}}"
				 data-slides-in-row="{{ layout }}">

				{% if show_arrows %}
					{%- if collection_list == blank or collection_list.size > 1 -%}
						<button class="swiper-button swiper-button--prev js-swiper-button-prev-{{ section.id }}">
							{%- render 'icons', icon: 'arrow-left' -%}
						</button>
					{%- endif -%}
				{% endif %}

				<div class="featured-products__row swiper-wrapper">
					{%- if collection_list != blank and collection_list.size > 0 -%}
						{%- for collection in collection_list -%}
							{%- assign products = collection.products | slice: 0, 4 -%} 
							
							{%- for product in products -%}
								<div class="featured-products__col swiper-slide featured-products__col--{{- layout -}}">
									{%- render 'product-card', product: product -%}
								</div>
							{%- endfor -%}
						{%- endfor -%}
					{%- else -%}
						{%- for i in (1..4) -%}
							<div class="featured-products__col swiper-slide featured-products__col--{{- layout -}}">
								{%- render 'product-card', product: nil -%}
							</div>
						{%- endfor -%}
					{%- endif -%}
				</div>

				{% if show_arrows %}
					{%- if collection_list == blank or collection_list.size > 1 -%}
						<button class="swiper-button swiper-button--next js-swiper-button-next-{{ section.id }}">
							{%- render 'icons', icon: 'arrow-right' -%}
						</button>
					{% endif %}
				{% endif %}

				{%- if collection_list.size > 1 or collection_list == blank -%}
					<div class="featured-products__slider-pagination js-featured-products-pagination"></div>
				{%- endif -%}
			</div>
		</div>
	</div>
</section>

{%- if collection_list.size > 1 or collection_list == blank -%}
	{%- render 'adastra' with '/src/scripts/section-featured-products.js' -%}
{%- endif -%}

{%- schema -%}
{
	"name": "Featured collections",
	"disabled_on": {
		"groups": ["header", "footer", "custom.popup"]
	},
	"settings": [
		{
			"type": "text",
			"id": "heading",
			"label": "Heading",
			"default": "Featured collections"
		},
		{
			"type": "collection_list",
			"id": "collection_list",
			"label": "Collections",
			"limit": 6
		},
		{
			"type": "select",
			"id": "layout",
			"label": "Layout",
			"options": [
				{
					"value": "3",
					"label": "3 products per row"
				},
				{
					"value": "4",
					"label": "4 products per row"
				}
			],
			"default": "4",
			"info": "Desktop only"
		},
		{
			"type": "checkbox",
			"id": "show_arrows",
			"label": "Show arrows",
			"default": true,
			"info": "Desktop only"
		},
		{
			"type": "select",
			"id": "container_width",
			"label": "Container width",
			"options": [
				{
					"value": "1432px",
					"label": "Default - 1400px"
				},
				{
					"value": "1952px",
					"label": "Large - 1920px"
				},
				{
					"value": "100%",
					"label": "Full width"
				},
				{
					"value": "inherit",
					"label": "Inherit from general settings"
				}
			],
			"default": "inherit"
		},
		{
			"type": "range",
			"id": "offset_top_desktop",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Desktop offset top",
			"default": 25
		},
		{
			"type": "range",
			"id": "offset_bottom_desktop",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Desktop offset bottom",
			"default": 25
		},
		{
			"type": "range",
			"id": "offset_top_mobile",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Mobile offset top",
			"default": 25
		},
		{
			"type": "range",
			"id": "offset_bottom_mobile",
			"min": 0,
			"max": 100,
			"step": 1,
			"unit": "px",
			"label": "Mobile offset bottom",
			"default": 25
		}
	],
	"presets": [
		{
			"name": "Featured collections"
		}
	]
}
{%- endschema -%}
