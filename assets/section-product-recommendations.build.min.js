const o={section:".js-product-recommendations",content:".js-product-recommendations-content",recommendations:"[data-product-recommendations]",recommendationsItems:".js-product-recommendations-col",recommendationsRowWrapper:".js-product-recommendations-row-wrapper",viewedLabel:".js-product-recommendations-viewed-label",viewedContent:".js-product-recommendations-viewed-content",productCard:".js-product-card",tabsButton:".js-product-recommendations-tab-button",tabsContent:".js-product-recommendations-tab-content",buttonsWrapper:".js-product-recommendations--buttons-wrapper",existingProduct:"[data-existing-product]"},x={id:"id"},p={section:"section_id",limit:"limit",product:"product_id",view:"view"},E=()=>{let h,w=[];const l={featuredContentSlider:"js-featured-content-slider",tabs:"is-tabs",...window.themeCore.utils.cssClasses};async function g(e){h=await window.themeCore.utils.getExternalUtil("FeaturedContentSlider"),w=C(e),await Promise.all(w.map(t=>S(t))),window.themeCore.LazyLoadImages.init(),w.forEach(t=>{let r={grabCursor:!0,slidesPerView:1.1618};const i=[...t.el.querySelectorAll(o.recommendationsRowWrapper)],a=t.layout==="alternative"?4:3;i.forEach(s=>{let d=!1,n={...r};[...s.querySelectorAll(o.productCard)].length>a&&(d=!0,n={...n,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{768:{slidesPerView:t.layout==="alternative"?4:3}}}),h(s,n,"",d).init()}),t.el.classList.remove(l.loading)})}function C(e){return[...document.querySelectorAll(o.section)].filter(t=>!e||t.closest(`#shopify-section-${e}`)).map(t=>{const r=t.getAttribute(x.id),i=window.themeCore.objects.routes.product_recommendations_url,a=t.dataset.productId,s=t.dataset.limit,d=t.dataset.layout,n=!!t.closest(o.recommendations);return{el:t,id:r,requestUrl:i,product:a,limit:s,enableRecommendations:n,layout:d}})}async function S(e){if(!e.enableRecommendations){if(!e.limit)return Promise.resolve();let t=e.el.querySelector(o.content);return await v(t,e),Promise.resolve()}try{const t=new URL(window.location.origin+e.requestUrl);t.searchParams.set(p.section,e.id),t.searchParams.set(p.product,e.product),t.searchParams.set(p.limit,e.limit),await fetch(t.toString()).then(r=>r.text()).then(async r=>{const i=document.createElement("div");i.innerHTML=r;const a=e.el.querySelector(o.content);let s=i.querySelector(o.content);const d=[...s.querySelectorAll(o.recommendationsItems)],n=s.querySelector(o.recommendationsRowWrapper);if(e.limit)s=await v(s,e);else if(!!!s.querySelector(o.existingProduct)){e.el.remove();return}s&&s.innerHTML.trim().length&&(a.innerHTML=s.innerHTML),d&&d.length&&n&&n.classList.add(l.featuredContentSlider),window.themeCore.EventBus.emit("compare-products:init")}).catch(r=>{console.error(r)})}catch(t){console.error(t)}}async function v(e,t){if(!e)return;let r=localStorage.getItem("theme_recently_viewed");const i=!!e.querySelector(o.existingProduct);if(!r)return i||t.el.remove(),e;try{if(r=JSON.parse(r),window.location.href.includes("/products/")){const c=new URL(window.location.href).pathname,m=(c.startsWith("/")?c.substring(1):c).split("/").pop();r=r.filter(u=>u!==m)}if(r=r.slice(-1*+t.limit),!r.length)return i||t.el.remove(),e;const a=(await b(r)).map(n=>n.value).filter(Boolean),s=a.map(n=>q(n,t)),d=e.querySelector(o.viewedContent);if(d){d.innerHTML=s.reduce((u,R)=>u+=R.outerHTML,"");const n=t.el.querySelector(o.viewedLabel);if(!n)return e;if(i)return n.classList.remove(l.hidden),a.length&&(t.el.classList.add(l.tabs),P(t)),e;const c=[...e.querySelectorAll(o.recommendationsRowWrapper)].find(u=>+u.dataset.index==1);c&&c.classList.add(l.hidden);const f=[...t.el.querySelectorAll(o.tabsButton)].find(u=>+u.dataset.index==1);f&&f.remove();const m=[...e.querySelectorAll(o.recommendationsRowWrapper)].find(u=>+u.dataset.index==2);return m&&m.classList.add(l.active),n.classList.remove(l.hidden),e}}catch(a){return console.log(a),e}return e}async function b(e){return await Promise.allSettled(e.map(t=>L(t)))}async function L(e){let t=new URL(`${window.location.origin}/products/${e}`);return t.searchParams.set(p.view,"card"),await fetch(t.toString()).then(r=>r.text()).then(r=>{const i=document.createElement("div");return i.innerHTML=r,i.querySelector(o.productCard)?i.querySelector(o.productCard):!1}).catch(r=>{console.error(r)})}function q(e,t){const r=document.createElement("div");return r.innerHTML=`
			<div class="product-recommendations__col swiper-slide product-recommendations__col--${t.layout}">
				${e.outerHTML}
			</div>
		`,r.querySelector(".product-recommendations__col")}function P(e){!e||!e.el||e.el.addEventListener("click",t=>{const r=t.target.closest(o.tabsButton);if(!r)return;const i=r.dataset.index,a=[...e.el.querySelectorAll(o.tabsButton)],s=[...e.el.querySelectorAll(o.tabsContent)],d=e.el.querySelector(o.buttonsWrapper);if(!i||!a.length||!s.length||!d)return;a.forEach(c=>c.classList.toggle(l.active,c===r)),s.forEach(c=>c.classList.toggle(l.active,c.dataset.index===i));const n=r.offsetLeft;d.scrollTo({left:n,behavior:"smooth"})})}return Object.freeze({init:g})},y=()=>{window.themeCore.ProductRecommendations=window.themeCore.ProductRecommendations||E(),window.themeCore.utils.register(window.themeCore.ProductRecommendations,"product-recommendations")};window.themeCore&&window.themeCore.loaded?y():document.addEventListener("theme:all:loaded",y,{once:!0});
