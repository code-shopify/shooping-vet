const n={card:".js-product-card",form:".js-product-card-form",imageWrapper:".js-product-card-images-wrapper",price:".js-price",button:".js-product-card-button",product:".js-product-card-product",option:"select[data-option], [data-option]:checked",hiddenInput:".js-product-card-variant-input",swatches:"[data-option-index]",formError:".js-product-card-error",checkmark:".js-product-card-checkmark",minQuantity:".js-product-card-min-value"},F=()=>{const m=window.themeCore.utils.cssClasses;function g(){v()}function v(){document.addEventListener("change",S),document.addEventListener("submit",b)}async function S(t){const e=t.target.closest(n.form);if(!e)return;const r=e.closest(n.card);if(!r)return;const o=r.dataset.section,c=[...r.querySelectorAll(n.imageWrapper)],s=e.querySelector(n.swatches),u=s&&s.dataset.optionIndex;let a=[...e.querySelectorAll(n.option)];const h=r.querySelector(n.price);let l=e.querySelector(n.button);l&&l.classList.contains(m.hidden)&&(l=null);const p=q(e.querySelector(n.product)),w=r.querySelector(n.checkmark),I=e.querySelector(n.formError);if(!p)return;const x=p.variants,O=a.map(i=>({[i.dataset.option]:i.value}));if(!((!u||a.some(i=>i.name===u))&&a.every(i=>i.value)))return;w&&w.classList.add(m.active);const C=e.querySelector(n.hiddenInput),d=L(x,O);d?(f(d.id,C),T(d.id,c),await k(p.handle,d.id,h)):(f("",C),M(h)),j(d,l||I),window.themeCore.EventBus.emit("product-card:change-variant",{sectionId:o})}function q(t){try{return JSON.parse(t.textContent)}catch{return null}}function L(t,e){return t.find(r=>e.every(o=>r[Object.keys(o)[0]]===Object.values(o)[0]))}function f(t,e){e&&(e.value=t)}function T(t,e){e.forEach(r=>r.classList.toggle(m.active,r.dataset.variant===String(t)))}async function k(t,e,r){if(!r)return;const o=P(t,e,"price").toString();if(!o)return;const c=await E(o,n.fetchPrice);r.innerHTML=c.querySelector(n.price)&&c.querySelector(n.price).outerHTML}async function E(t,e){try{const o=await(await fetch(t)).text();let c=new DOMParser().parseFromString(o,"text/html");return e&&(c=c.querySelector(e)),c}catch(r){console.error(r)}}function j(t,e){if(!e)return;const r=!e.matches(n.button);t?t.available?r?e.innerHTML="":e.innerHTML=window.themeCore.translations.get("products.product.add_to_cart"):e.innerHTML=window.themeCore.translations.get("products.product.sold_out"):e.innerHTML=window.themeCore.translations.get("products.product.unavailable"),!r&&(e.disabled=!t||!t.available)}function P(t,e,r){if(!t)return;const o=new URL(`${window.location.origin}/products/${t}`);return o.searchParams.set("view",r),e&&o.searchParams.set("variant",e),o}function M(t){t&&(t.innerHTML="")}async function b(t){const e=t.target.closest(n.form),r=e&&new FormData(e),o=e&&e.querySelector(n.hiddenInput),c=e&&e.querySelector(n.minQuantity),s=o&&o.value,u=c?Number(c.value):1;if(!r||!s)return;t.preventDefault();const a=await A(s,u);H(e,a),a&&window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.GET_CART)}async function A(t,e){try{await window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.ADD_TO_CART,{id:t,quantity:e})}catch(r){return r.description}}function H(t,e=""){const r=t&&t.querySelector(n.formError);r&&(r.innerText=e)}return Object.freeze({init:g})},y=()=>{window.themeCore.ProductCardWithForm=window.themeCore.ProductCardWithForm||F(),window.themeCore.utils.register(window.themeCore.ProductCardWithForm,"product-card-with-banner")};window.themeCore&&window.themeCore.loaded?y():document.addEventListener("theme:all:loaded",y,{once:!0});
