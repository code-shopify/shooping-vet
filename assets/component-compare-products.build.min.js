const N=()=>{const a={addButton:".js-compare-products-button",productButton:".js-compare-products-popup-button",stickyAddToCart:".js-sticky-add-to-cart",compareProductCard:".js-compare-product",compareProducts:".js-compare-products",modal:"compare-products",compareProductRow:".js-product-compare-row",removeButton:".js-product-compare-remove",clearButton:".js-compare-products-clear"},s={product:"data-product-handle",productTitle:"data-product-title",ariaLabel:"aria-label",count:"data-count",empty:"data-empty"},v=`<svg width="16" height="16" aria-hidden="true" focusable="false" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M12 4L4 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
		<path d="M4 4L12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
	</svg>
	`,b=6,p={...window.themeCore.utils.cssClasses,bigPadding:"big-padding"};let d,m,h,f,u,l;function _(){d=document.querySelector(a.productButton),d&&(k(),g(),L(),A())}function L(){window.themeCore.EventBus.listen("compare-products:init",g)}function g(){m={add:window.themeCore.translations.get("products.compare_products.product_button_add"),remove:window.themeCore.translations.get("products.compare_products.product_button_remove"),error:window.themeCore.translations.get("products.compare_products.quantity_error")},h=window.themeCore.utils.overlay,f=window.themeCore.utils.Toggle;const e=[...document.querySelectorAll(a.addButton)];if(!e.length)return;const t=i();e.forEach(o=>{const c=o.getAttribute(s.product);if(!c)return;const r=o.getAttribute(s.productTitle);if(r){const n=m[t.includes(c)?"remove":"add"].replaceAll("{{ product }}",r);o.setAttribute(s.ariaLabel,n)}o.classList.toggle(p.active,t.includes(c)),o.classList.remove(p.hidden)}),d.setAttribute(s.count,t.length)}function i(){const e=localStorage.getItem("theme-compare-products");if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function w(e){if(e){if(e.length>b){j();return}localStorage.setItem("theme-compare-products",JSON.stringify(e)),g()}}function P(e){let t=i();t.includes(e)?t=t.filter(o=>o!==e):t=[...t,e],w(t)}function C(e){let t=i();t=t.filter(o=>o!==e),w(t)}function B(){w([])}function A(){document.addEventListener("click",S),document.addEventListener("click",T),d.addEventListener("click",E)}function S(e){const t=e.target.closest(a.addButton);if(!t)return;const o=t.getAttribute(s.product);o&&P(o)}function T(e){const t=e.target.closest(a.removeButton),o=e.target.closest(a.clearButton);if(!t&&!o)return;if(o){B(),l.close(u);return}const c=t.getAttribute(s.product);if(!c)return;C(c);const r=i().length,n=document.querySelector(a.compareProducts);if(n){if(r<2){l.close(u);return}[...n.querySelectorAll(`[${s.product}="${c}"]`)].forEach(H=>H.remove()),n.style=`--compare-products-count: ${r}`}}function k(){!!document.querySelector(a.stickyAddToCart)&&d.classList.add(p.bigPadding)}function j(){setTimeout(()=>{const e=window.themeCore.CartNotificationError;e.addNotification(m.error,window.themeCore.translations.get("products.compare_products.quantity_error_heading")),e.open()})}async function E(){const e=i();d.disabled=!0,h({namespace:"compare-products-preloader"}).open(!0);let t=(await $()).map(c=>c.value);t.forEach((c,r)=>!c&&C(e[r])),t=t.filter(Boolean),u=x(t),u.style=`--compare-products-count: ${t.length}`,document.body.append(u);const o={toggleSelector:a.modal,previouslySelectedElement:d};l=f(o),l.init({once:!0}),l.open(u),setTimeout(()=>u.focus(),50),d.disabled=!1}async function $(){const e=i();try{return await Promise.allSettled(e.map(t=>M(t)))}catch(t){console.log(t)}}async function M(e){const t=`/products/${e}?view=compare`;return await q(t,a.compareProductCard)}async function q(e,t){try{const c=await(await fetch(e)).text();let r=new DOMParser().parseFromString(c,"text/html");return t&&(r=r.querySelector(t)),r}catch(o){console.log(o)}}function x(e){const t=document.createElement("html");t.innerHTML=e.map(r=>r.outerHTML).join(" ");let o=Array.from(Array(11)).map((r,n)=>[...t.querySelectorAll(`${a.compareProductRow}[data-index="${n+1}"]`)]);o=o.filter(r=>!r.every(n=>n.hasAttribute(s.empty)));const c=document.createElement("html");return c.innerHTML=`
			<div
			class="modal compare-products js-compare-products"
			id="compare-products"
			data-modal-once="true"
			tabindex="-1"
			aria-modal="true"
			role="dialog"
			>
				<header class="modal__header compare-products__header">
					${window.themeCore.compareProductsTitle&&`<h2 class="compare-products__heading">
							${window.themeCore.compareProductsTitle}
						</h2>`}
					${window.themeCore.translations.get("products.compare_products.clear_all")&&`<button class="compare-products__clear js-compare-products-clear focus-visible-outline">
						${window.themeCore.translations.get("products.compare_products.clear_all")}
					</button>`}

					<button
						class="popup-close-icon-button focus-visible-outline"
						data-target="compare-products"
						data-js-toggle="compare-products"
						aria-label="${window.themeCore.translations.get("general.accessibility.close_modal")}">
						${v}
					</button>


					<button
						class="popup-close-icon-button focus-visible-outline"
						data-target="compare-products"
						aria-label="${window.themeCore.translations.get("general.accessibility.close")}"
						data-js-toggle="compare-products"
					>
						<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M14 1.41L12.59 0L7 5.59L1.41 0L0 1.41L5.59 7L0 12.59L1.41 14L7 8.41L12.59 14L14 12.59L8.41 7L14 1.41Z"></path>
						</svg>
					</button>
				</header>

				<div class="modal__body compare-products__body">
					<div class="modal__body compare-products__content compare-product-card">
						${o.map(r=>r.map(n=>n.outerHTML).join("")).join("")}
					</div>
				</div>
			</div>
		`,c.querySelector(a.compareProducts)}return Object.freeze({init:_})},y=()=>{window.themeCore.CompareProducts=window.themeCore.CompareProducts||N(),window.themeCore.utils.register(window.themeCore.CompareProducts,"compare-products")};window.themeCore&&window.themeCore.loaded?y():document.addEventListener("theme:all:loaded",y,{once:!0});
