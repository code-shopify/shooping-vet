const b=()=>{const i={favoritesButton:".js-favorites-product-button",clearAllButton:".js-favorites-clear-all",favoritesContainer:".js-favorites-container",favoritesHeaderIcon:".js-favorites-header-icon",productCard:".js-product-card",emptyMessage:".js-favorites-empty-text",pageLoader:".js-page-preloader"},n={productHandle:"data-product-handle",productTitle:"data-product-title",ariaLabel:"aria-label",count:"data-count",empty:"data-empty"},h=12,s={...window.themeCore.utils.cssClasses};let f=!!document.querySelector(i.favoritesContainer),c,v,a;const p=document.querySelector(i.pageLoader);function w(){c=document.querySelectorAll(i.favoritesHeaderIcon),c.length&&(l(),y(),C(),f&&P())}function y(){window.themeCore.EventBus.listen("favorites-list:init",l)}function l(){const e=document.querySelectorAll(i.favoritesButton),t=u();f&&(c.forEach(function(r){r.setAttribute(n.count,t.length)}),t.length>0?(c.forEach(function(r){r.classList.add(s.active)}),a&&a.classList.add(s.hidden)):(c.forEach(function(r){r.classList.remove(s.active)}),a&&a.classList.remove(s.hidden))),c.forEach(function(r){r.setAttribute(n.count,t.length),r.classList.toggle(s.active,t.length>0)}),e.length&&(v={add:window.themeCore.translations.get("products.favorites.add_to_favorites"),remove:window.themeCore.translations.get("products.favorites.remove_from_favorites"),error:window.themeCore.translations.get("products.favorites.quantity_error")},e.forEach(r=>{const o=r.getAttribute(n.productHandle);if(!o)return;const d=r.getAttribute(n.productTitle);if(d){const j=t.includes(o)?"remove":"add",T=v[j].replaceAll("{{ product }}",d);r.setAttribute(n.ariaLabel,T)}r.classList.toggle(s.active,t.includes(o)),r.classList.remove(s.hidden)}))}function u(){const e=localStorage.getItem("theme-favorites-list");if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function C(){document.addEventListener("click",L)}function L(e){const t=e.target.closest(i.favoritesButton);if(!t)return;const r=t.getAttribute(n.productHandle);r&&E(r)}function E(e){let t=u();t.includes(e)?(t=t.filter(r=>r!==e),f&&M(e)):t=[...t,e],m(t)}function S(e){let t=u();t=t.filter(r=>r!==e),m(t)}function m(e){if(e){if(e.length>h){F();return}localStorage.setItem("theme-favorites-list",JSON.stringify(e)),l()}}function F(){setTimeout(()=>{const e=window.themeCore.CartNotificationError;e.addNotification(v.error,window.themeCore.translations.get("products.favorites.quantity_error_heading")),e.open()})}function M(e){if(!e)return;const t=document.querySelector(i.favoritesContainer);if(!t)return;const r=t.querySelector(`${i.favoritesButton}[${n.productHandle}="${e}"]`);if(!r)return;const o=r.closest(".js-favorites-item");o&&o.remove()}async function P(){let e=u(),t=await B();t.forEach((r,o)=>!r&&S(e[o])),t=t.filter(Boolean),_(t),a=document.querySelector(i.emptyMessage),t.length===0&&a&&a.classList.remove(s.hidden),window.themeCore.LazyLoadImages.init(),l(),window.themeCore.EventBus.emit("compare-products:init"),setTimeout(()=>{p.classList.remove(s.active)},300)}async function B(){const e=u();try{return await Promise.all(e.map(t=>q(t)))}catch(t){console.log(t)}}async function q(e){const t=`/products/${e}?view=card`;return await A(t,i.productCard)}async function A(e,t){try{const o=await(await fetch(e)).text();let d=new DOMParser().parseFromString(o,"text/html");return t&&(d=d.querySelector(t)),d}catch(r){console.log("error:",r)}}function _(e){if(!e.length)return;const t=document.querySelector(i.favoritesContainer);t&&e.forEach(r=>{let o=document.createElement("div");o.classList.add("favorites-grid__item","js-favorites-item"),o.append(r),t.append(o)})}return Object.freeze({init:w})},g=()=>{window.themeCore.MyFavorites=window.themeCore.MyFavorites||b(),window.themeCore.utils.register(window.themeCore.MyFavorites,"my-favorites")};window.themeCore&&window.themeCore.loaded?g():document.addEventListener("theme:all:loaded",g);
