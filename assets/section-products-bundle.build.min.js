const n={section:".js-products-bundle",button:".js-products-bundle-button",cardButton:".js-product-card-button",hiddenInput:".js-product-card-variant-input",formError:".js-product-card-error",error:".js-product-bundle-error",total:".js-product-total",totalPrice:".js-product-total-price",amount:"[data-amount]",card:".js-product-card",isCurrencyEnabled:"[data-currency-code-enabled]"},q={amount:"data-amount"},b=()=>{let s,l;async function h(e){s=[...document.querySelectorAll(n.section)].filter(t=>!e||t.closest(`#shopify-section-${e}`)),s.forEach(t=>i(t))}function i(e){if(!e)return;const o=e.querySelector(n.isCurrencyEnabled)?window.themeCore.objects.shop.money_with_currency_format:window.themeCore.objects.shop.money_format;l=c=>window.themeCore.utils.formatMoney(c,o);const r=e.dataset.section,u=e.querySelector(n.button);if(!u)return;const a={enabled:u.dataset.enabledLabel,disabled:u.dataset.disabledLabel};window.themeCore.EventBus.listen("product-card:change-variant",c=>y({event:c,section:e,sectionId:r,button:u,buttonLabels:a})),e.addEventListener("click",C),m(e)}function y({event:e,section:t,sectionId:o,button:r,buttonLabels:u}){if(e.sectionId!==o)return;const a=[...t.querySelectorAll(n.hiddenInput)],c=[...t.querySelectorAll(n.formError)],w=a.every(d=>d.value)&&c.every(d=>d.innerText!==window.themeCore.translations.get("products.product.sold_out"));r.disabled=!w,r.innerHTML=u[w?"enabled":"disabled"],m(t)}function m(e){const t=e.querySelector(n.total),o=e.querySelector(n.totalPrice),r=f(e);!t||!o||(t.classList.toggle(window.themeCore.utils.cssClasses.active,r!==null),r!==null&&(o.innerText=l(r)))}function f(e){const o=[...e.querySelectorAll(n.card)].map(r=>{const u=r.querySelector(n.amount),a=r.querySelector(n.hiddenInput);return!u||!a||!a.getAttribute("value")?null:u.getAttribute(q.amount)||null});return o.includes(null)?null:o.reduce((r,u)=>r+=+u,0)}async function C(e){const t=e.target.closest(n.button);if(!t)return;const o=t.closest(n.section);if(!o)return;const r=o.querySelector(n.error),u=[...o.querySelectorAll(n.hiddenInput)].map(c=>c.value),a=await A(u);r&&(r.innerHTML=a),!a&&window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.GET_CART)}async function A(e){try{return await window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.ADD_TO_CART_MANY,e.map(t=>({id:t,quantity:1}))),""}catch(t){return t.description}}return Object.freeze({init:h,initSection:i})},p=()=>{window.themeCore.ProductsBundle=window.themeCore.ProductsBundle||b(),window.themeCore.utils.register(window.themeCore.ProductsBundle,"products-bundle"),window.themeCore.utils.registerExternalUtil(b,"products-bundle")};window.themeCore&&window.themeCore.loaded?p():document.addEventListener("theme:all:loaded",p,{once:!0});
