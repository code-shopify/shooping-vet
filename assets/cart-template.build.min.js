const ue=()=>{const j=window.themeCore.utils.Toggle,y=window.themeCore.utils.cssClasses,P=window.themeCore.utils.formToJSON,R=window.themeCore.utils.on,U=window.themeCore.utils.QuantityWidget,F=window.themeCore.utils.CartUpsell,M=window.themeCore.utils.Preloder,n={section:'[data-section-type="cart-template"]',sectionDrawer:'[data-section-modification="drawer"]',upsellDrawer:"#CartUpsellDrawer",subtotal:".js-cart-subtotal",container:".js-cart-container",content:".js-cart-content",termsAndConditionsCheckbox:".js-terms-and-conditions-checkbox",buttonsContent:".js-cart-footer-button",cartButton:".js-cart-button",additionalButtons:".js-cart-footer-additional-buttons",cartItem:"[data-cart-item]",quantity:".js-quantity",quantityError:".js-cart-item-error-message",remove:".js-cart-item-remove",closeButton:".js-cart-close-button",cartNoteField:".js-cart-notes-field",cartDrawerNoteControlText:".js-cart-note-control-text",cartFooterButtonMessage:".js-cart-footer-button-message",submit:'[type="submit"]',scrollable:"[data-scrollable]",upsellMobileTrigger:".js-cart-upsell-trigger",cartEmptySlider:".js-cart-empty-slider",cartEmptyButtonPrev:".js-cart-empty-button-prev",cartEmptyButtonNext:".js-cart-empty-button-next"},C={...y,empty:"is-empty"},z={disableButton:"data-disable-button"};let E=[],q=[];function V(){H(),D(),J(),x(),W(),window.themeCore.objects.settings.show_shipping_rates_calculator&&window.Shopify&&ae()}let B=!1;function H(){const e=window.themeCore.utils.Swiper,r=document.querySelector(n.cartEmptySlider);r&&new e(r,{slidesPerView:2,spaceBetween:16,navigation:{nextEl:n.cartEmptyButtonNext,prevEl:n.cartEmptyButtonPrev},breakpoints:{768:{slidesPerView:1.85}}})}function D(){const e=document.querySelector(n.termsAndConditionsCheckbox),r=document.querySelector(n.cartButton);function t(){r.hasAttribute(z.disableButton)&&(r.disabled=!e.checked)}e&&(t(),e.addEventListener("change",()=>{t()}))}function J(){q=[...document.querySelectorAll(n.sectionDrawer)].map(e=>{const r=j({toggleSelector:e.id,closeAccordionsOnHide:!1});r.init();const t={el:e,toggle:{open:()=>r.open(e),close:()=>r.close(e)}};return Q(t),t})}function Q(e){!e||!e.toggle||(window.themeCore.EventBus.listen(`cart:drawer:${e.el.id}:open`,e.toggle.open),window.themeCore.EventBus.listen(`cart:drawer:${e.el.id}:close`,e.toggle.close))}function x(){E=Array.from(document.querySelectorAll(n.section)).map(e=>({el:e,id:e.dataset.sectionId,content:e.querySelector(n.content)})),E.forEach(e=>{const r=Array.from(e.el.querySelectorAll(n.quantity));!r||!r.length?e.quantityWidgets=[]:e.quantityWidgets=r.map(i=>U(i,{onQuantityChange:te}).init());const t=M(e.el);t&&(e.preloader=t.init()),e.upsell={};const o=e.el.querySelector(n.upsellDrawer),u=F(o,{onFormSubmit:oe});if(u&&o){e.upsell=u.init();const i=e.el.querySelector(n.upsellMobileTrigger);i&&i.replaceWith(i.cloneNode(!0)),e.upsell.drawer=j({toggleSelector:e.upsell.container.id,closeAccordionsOnHide:!1,overlay:!1}),e.upsell.drawer.init();const a=M(e.upsell.container);a&&(e.upsell.preloader=a.init()),window.themeCore.EventBus.listen(`Toggle:${e.el.id}:close`,function(){e.upsell.drawer.close(e.upsell.container)})}R("click",e.el,re)}),ie(),window.themeCore.LazyLoadImages.init()}function W(){window.themeCore.EventBus.listen("cart:updated",se),window.themeCore.EventBus.listen("cart:refresh",A),window.themeCore.EventBus.listen("cart:drawer:open",$),window.themeCore.EventBus.listen("cart:drawer:refresh-and-open",Y),window.themeCore.EventBus.listen("cart:drawer:close",Z),document.addEventListener("click",e=>e.target.closest(n.closeButton)&&window.themeCore.EventBus.emit("cart:drawer:close")),document.addEventListener("change",K)}async function K(e){const r=e.target.closest(n.cartNoteField),t=document.querySelector(n.cartDrawerNoteControlText);if(r){S();try{await window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.UPDATE_CART,{note:r.value})}catch(o){console.log(o)}finally{T(),t&&(r.value!==""?t.textContent=window.themeCore.translations.get("cart.general.edit_note"):t.textContent=window.themeCore.translations.get("cart.general.note"))}}}function L(){return E.map(e=>e.id)}function G(){const e=L(),r=new URL(window.location.href);return r.searchParams.set("sections",e.join(",")),r.searchParams.set("lazyload","false"),fetch(r.href).then(t=>t.json())}function $(e){if(e&&e.id){window.themeCore.EventBus.emit(`cart:drawer:${e.id}:open`);return}const r=q.find(t=>t.toggle&&t.toggle.open);r&&r.toggle.open()}function Y(e){A().then(()=>{$(e)})}function Z(e){if(e&&e.id){window.themeCore.EventBus.emit(`cart:drawer:${e.id}:close`);return}q.forEach(r=>{r.toggle&&r.toggle.close&&r.toggle.close()})}function S(){E.forEach(e=>{e.preloader&&e.preloader.show(),e.upsell&&e.upsell.preloader&&e.upsell.preloader.show()})}function T(){E.forEach(e=>{e.preloader&&e.preloader.hide(),e.upsell&&e.upsell.preloader&&e.upsell.preloader.hide()})}async function A(e=null){const r=e&&Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype?await G():e;if(!r)return!1;E.map(t=>{const o=new DOMParser().parseFromString(r[t.id],"text/html"),u=o.querySelector(n.section),i=o.querySelector(n.content),a=o.querySelector(n.subtotal),d=o.querySelector(n.buttonsContent),l=o.querySelector(n.additionalButtons),p=o.querySelector(n.cartFooterButtonMessage),c=o.querySelector(n.upsellDrawer);if(!u||!i)return;t.el.classList.toggle(C.empty,u.classList.contains(C.empty));const m=t.el.querySelector(n.content);if(!m)return;if(d){const s=t.el.querySelector(n.buttonsContent);s&&s.innerHTML!==d.innerHTML&&(s.innerHTML=d.innerHTML)}if(p){const s=t.el.querySelector(n.cartFooterButtonMessage);s&&s.outerHTML!==p.outerHTML&&(s.outerHTML=p.outerHTML)}if(l){const s=t.el.querySelector(n.additionalButtons);s&&s.innerHTML!==l.innerHTML&&s.classList.toggle(C.hidden,l.classList.contains(C.hidden))}if(a){const s=t.el.querySelector(n.subtotal);s&&(s.innerHTML=a.innerHTML)}const w=t.el.querySelector(n.upsellMobileTrigger);if(w&&w.classList.toggle(C.hidden,!c),!c&&t.upsell.container)t.upsell.container.outerHTML="",t.upsell.container.remove();else if(c)if(t.upsell.container){const s=t.upsell.container.querySelector(n.scrollable),f=s?s.scrollTop:0,h=t.upsell.refresh(c);if(h){t.upsell.container.innerHTML=h;const g=t.upsell.container.querySelector(n.scrollable);g&&g.scrollTo({top:f})}else t.upsell.container.outerHTML="",t.upsell.container.remove()}else t.el.insertAdjacentHTML("beforeend",c.outerHTML);m.innerHTML=i.innerHTML}),x(),H(),D()}function X(e,r){window.themeCore.EventBus.emit("product-card:quick-view:clicked",{productHandle:e,variant:r})}async function ee(e,r){try{await window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.ADD_TO_CART,{id:e,quantity:r})}catch(t){return t&&t.description}}function te(e){if(!e||!e.controls||!e.controls.input)return;S();const t=e.controls.input.dataset.itemKey,o=e.quantity.value,u=L().join(",");window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.CHANGE_CART_ITEM_QUANTITY,t,o,u).then(async i=>{let a=i.items.find(d=>d.key===t);if(a&&o!==a.quantity){const d=window.themeCore.translations.get("cart.errors.quantity",{count:a.quantity,title:a.title});throw B=!0,setTimeout(()=>{B=!1},0),{description:d}}}).catch(i=>{ne(e,i)}).finally(()=>{T()})}function re(e){const r=e.target.closest(n.remove);if(!r)return;e.preventDefault(),S();const t=L().join(","),o=r.dataset.itemKey;window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.REMOVE_CART_ITEM,o,t).finally(()=>{T()})}function ne(e,r){if(!e||!r)return;e.rollbackValue();const t=e.widget.closest(n.cartItem);if(!t)return;const o=t.querySelector(n.quantityError);o.innerHTML=r.message||r.description}function oe(e){const r=e.target;if(!r)return;e.preventDefault();const t=P(r),{id:o,handle:u,singleVariant:i,quantity:a}=t;if(!JSON.parse(i)){X(u,o);return}S();const d=r.querySelector(n.submit);d&&d.classList.add(C.loading),ee(o,Number(a)).then(()=>{d&&d.classList.remove(C.loading),window.themeCore.EventBus.emit("Toggle:CartUpsellDrawer:close"),T()})}function se(e){let r=null;e&&(r=e.sections),B||A(r).then(()=>{const t=window.themeCore.objects.settings.show_cart_notification,o=!e.params.some(u=>u.noOpen);!JSON.parse(t)&&o&&window.themeCore.EventBus.emit("cart:drawer:open")})}function ie(){let e=document.querySelector(".js-cart-shipping");if(!e)return;let r=Shopify.currency.rate||1,t=window.themeCore.objects.shop.money_format,o=Number(e.getAttribute("data-cart-total")),u=e.getAttribute("data-amount-cents")*r,i=o/u*100,a=e.getAttribute("data-amount-message"),d=e.getAttribute("data-success-message"),l=e.querySelector(".js-cart-shipping-progress-bar"),p=e.querySelector(".js-cart-shipping-amount-msg"),c=e.querySelector(".js-cart-shipping-icon"),m=e.querySelector(".js-shipping-bar-progress-hidden-text"),w=window.themeCore.translations.get("cart.shipping_bar.progress").replace("{{ value }}",i.toFixed(1));if(e.style.setProperty("--shipping-bar-progress-value",i+"%"),m&&(m.textContent=w),i<100){let s=u-o,f=window.themeCore.utils.formatMoney(s,t),h=a.replace("{amount}",`<strong>${f}</strong>`);p.innerHTML=h,l.classList.remove(y.hidden),c&&c.classList.add(y.hidden)}else p.innerHTML=d,l.classList.add(y.hidden),c&&c.classList.remove(y.hidden)}function ae(){new window.Shopify.CountryProvinceSelector("cart-address-country","cart-address-province",{hideElement:"cart-address-province-container"});const e=document.querySelector(".js-get-ship-rates"),r=document.querySelectorAll(".js-ship-rate-field"),t=document.getElementById("cart-address-country"),o=document.getElementById("cart-address-province"),u=document.getElementById("cart-address-zip"),i=document.getElementById("cart-rates-wrapper");let a={country:"",province:"",zip:""};r.forEach(function(l){let p="keyup";l.tagName==="SELECT"&&(p="change"),l.addEventListener(p,()=>{d(l)})}),e.addEventListener("click",function(l){l.preventDefault(),e.setAttribute("disabled",""),a.country=t.value||"",a.province=o.value||"",a.zip=u.value||"";const p=`shipping_address[country]=${a.country}&shipping_address[province]=${a.province}&shipping_address[zip]=${a.zip}`,c=encodeURI(`${p}`);try{fetch(`/cart/prepare_shipping_rates.json?${c}`,{method:"POST"}).then(m=>m.text()).then(m=>{const w=JSON.parse(m);if(typeof w=="object"&&w!==null){Object.entries(w).forEach(([s,f])=>{const h=document.getElementById(`cart-address-${s}`),g=document.getElementById(`error-cart-address-${s}`);g&&(g.textContent=`${f}`,g.classList.remove(y.hidden),h.setAttribute("aria_invalid","true"),h.setAttribute("aria_describedby",`error-cart-address-${s}`))}),e.removeAttribute("disabled");return}fetch(`/cart/async_shipping_rates.json?${c}`).then(s=>s.text()).then(s=>{const f=JSON.parse(s),h=f?f.shipping_rates:[];if(e.removeAttribute("disabled"),h.length>0){i.innerHTML="";const g=document.createElement("ul");g.classList.add("cart-shipping-calc__rate-list"),h.forEach(_=>{const N=document.createElement("li");g.appendChild(N);const le=_.name;let b=_.price;const k=_.delivery_days;let v="";b==="0.00"?b=window.themeCore.translations.get("cart.shipping_rates.price_free"):b=`${window.themeCore.utils.formatMoney(b.includes(".")?b:b+".00",window.themeCore.objects.shop.money_format)}`,k.length&&(k.forEach((O,ce)=>{v=ce===0?O:`${v}-${O}`}),v=`<span>${v} days</span>`),N.innerHTML=`<span class="cart-shipping-calc__rate-name">${le}:</span> ${v} ${b}`}),i.appendChild(g)}else i.innerHTML=window.themeCore.translations.get("cart.shipping_rates.no_shipping")})})}catch(m){console.log(m,"Error with shipping rates")}});function d(l){if(!l)return;const p=l.id.split("cart-address-")[1],c=document.getElementById(`error-cart-address-${p}`);l.removeAttribute("aria_invalid"),l.removeAttribute("aria_describedby"),c&&(c.classList.add(y.hidden),c.textContent="")}}return Object.freeze({init:V})},I=()=>{window.themeCore.Cart=window.themeCore.Cart||ue(),window.themeCore.utils.register(window.themeCore.Cart,"cart-template")};window.themeCore&&window.themeCore.loaded?I():document.addEventListener("theme:all:loaded",I,{once:!0});
