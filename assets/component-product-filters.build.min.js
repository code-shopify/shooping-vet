const fe=l=>{const f={...window.themeCore.utils.cssClasses,searchWithSideBar:"search--with-sidebar"},K=window.themeCore.utils.Toggle,B=window.themeCore.utils.overlay,h={form:".js-form",emptyTitle:".js-template-empty-title",gridWrapper:".js-grid-wrapper",searchSideBar:".js-search-sidebar",filterMenuOpenerWrapper:".js-filter-menu-opener-wrapper",filterMenuOpener:".js-filter-menu-opener",activeFiltersCounter:".js-active-filters-counter",selectedFiltersWrapper:".js-selected-filters-wrapper",filtersContainer:".js-filters-container",filterAccordionItem:".js-accordion-filter-item",filterLists:".js-filter-list",filterPrice:".js-filter-price",pagination:".js-pagination",loadMoreButton:".js-lazy-load",infiniteScroll:".js-infinite-scroll",filtersBody:".js-filters-body",search:".js-search"},L={maxInput:".js-price-input-max",minInput:".js-price-input-min",rangeInputs:".js-range-inputs",minRange:".js-price-range-min",maxRange:".js-price-range-max",priceProgress:".js-price-progress"},a={collectionHeader:".js-collection-header",filterMenuToggler:"filterMenuToggler",paginationLink:".js-pagination-link",priceNumberInput:".js-price-input",priceRangeInput:".js-price-range",removeFilterLink:".js-remove-filter",resetFilters:".js-reset-filters",cssRoot:":root",header:"[data-header-container]",pageLoader:".js-page-preloader",productFilters:".js-product-filters",searchTypes:".js-search-types",searchTypeActiveButton:"[data-search-type].is-active",...h,...L},c={fixed:"is-fixed",noEvents:"no-events",error:"is-error",...f},T={priceFrom:"filter.v.price.gte",priceTo:"filter.v.price.lte"},M={query:"q",type:"type",optionsPrefix:"options[prefix]"},C={page:"page",sort:"sort_by",...M},b={rangeMin:"--range-min",rangeMax:"--range-max",headerHeight:"--header-height",headerOffsetTop:"--header-offset-top"},Y={extraSmall:"(max-width: 767px)"},y={extraSmallScreen:window.matchMedia(Y.extraSmall),openMenuButtonObserver:null,infiniteScrollObserver:null,cssRoot:document.querySelector(a.cssRoot)},z=K({toggleSelector:a.filterMenuToggler,closeAccordionsOnHide:!1,toggleTabIndex:!1});let i=p(l,h);const w=document.querySelector(a.pageLoader);function p(t,e){const r={};return Object.entries(e).forEach(([n,s])=>{const o=[...t.querySelectorAll(s)];if(!o.length){r[n]=null;return}if(o.length>1){r[n]=o;return}r[n]=o[0]}),t!=null&&t.matches&&t.matches(e.search)&&(r.search=t),r}function G(){let t=j();t=0;const e={rootMargin:`-${t}px 0px 0px 0px`};y.openMenuButtonObserver=P(i.filterMenuOpenerWrapper,A,J,e)}function j(){const t=y.cssRoot.style.getPropertyValue(b.headerHeight),e=y.cssRoot.style.getPropertyValue(b.headerOffsetTop);return parseInt(t)+parseInt(e)}function R(){y.infiniteScrollObserver=P(i.infiniteScroll,()=>le(y.infiniteScrollObserver,i.infiniteScroll))}function P(t,e,r,n={}){const s=new IntersectionObserver(o=>{o.forEach(d=>{d.isIntersecting?typeof e=="function"&&e():typeof r=="function"&&r()})},n);return s.observe(t),s}function A(){i.filterMenuOpener&&(i.filterMenuOpener.classList.remove(c.fixed),i.filterMenuOpenerWrapper.style.minHeight="auto")}function J(){!i.filterMenuOpener||Q(i.filterMenuOpenerWrapper)||(i.filterMenuOpenerWrapper.style.minHeight=`${i.filterMenuOpenerWrapper.offsetHeight}px`,i.filterMenuOpener.classList.add(c.fixed))}function Q(t){const e=j();return t.offsetTop+t.offsetHeight>=window.pageYOffset+e}async function X(t){const e=t.target.closest(a.form);if(!e||ee())return;const r=new FormData(e),n=[...r.keys()],{minInput:s,maxInput:o}=p(l,L);n.forEach(u=>{(u===T.priceFrom||u===T.priceTo)&&(u===T.priceFrom&&Number(s.value)===Number(s.min)||u===T.priceTo&&Number(o.value)===Number(o.max))&&r.delete(u)});const d=Z(r);e.classList.add(c.loading),window.parent===window.top&&window.history.pushState({},null,d),await v(d),e.classList.remove(c.loading),window.themeCore.Accordion.setTabIndex(".product-filters__form-accordion","hidden")}function Z(t){const e=new URLSearchParams(t).toString(),r=new URL(window.location.href),n=new URL(`${window.location.origin}${window.location.pathname}?${e}`);for(const s in M){const o=r.searchParams.get(M[s]);o&&n.searchParams.set(M[s],o)}return n}function ee(){return i.filterPrice?[...i.filterPrice.querySelectorAll(a.priceNumberInput)].some(e=>e.classList.contains(c.error)):!1}async function v(t){i.gridWrapper.ariaBusy="true";const e=q(t,l.id),r=await W(e),n=p(r,h);te(n),window.themeCore.LazyLoadImages.init(),i.gridWrapper.ariaBusy="false",window.themeCore.EventBus.emit("compare-products:init")}function q(t,e=l.id){const r=new URL(t);return r.searchParams.set("section_id",e),r.toString()}async function W(t){const r=await(await fetch(t)).text();return new DOMParser().parseFromString(r,"text/html")}function te(t){if(!t||!Object.keys(t).length)return;const{selectedFiltersWrapper:e,gridWrapper:r,filterMenuOpener:n,activeFiltersCounter:s,filterAccordionItem:o,filterPrice:d,pagination:u,loadMoreButton:x,infiniteScroll:N,filtersBody:F,searchSideBar:$,search:V}=t;V&&i.search&&i.search.classList.toggle(f.searchWithSideBar,V.classList.contains(f.searchWithSideBar)),$&&i.searchSideBar&&i.searchSideBar.classList.toggle(f.hidden,$.classList.contains(f.hidden));const O=document.querySelector(a.productFilters);if(O&&e&&!i.selectedFiltersWrapper&&(i.filtersBody.innerHTML=F.innerHTML,O.classList.remove(f.hidden),i=p(l,h),window.themeCore.Accordion.init(),d&&S()),O&&i.selectedFiltersWrapper&&!e&&F&&(i.filtersBody.innerHTML=F.innerHTML,O.classList.add(f.hidden),i=p(l,h)),i.gridWrapper.innerHTML=r.innerHTML,r.innerHTML?(i.emptyTitle.classList.add(c.hidden),i.emptyTitle.ariaHidden="true"):(i.emptyTitle.classList.remove(c.hidden),i.emptyTitle.ariaHidden="false"),i.filtersContainer){const m=i.filtersContainer.querySelectorAll(a.filterAccordionItem);Array.from(m).forEach(g=>{o&&Array.from(o).length===0?g.id!==o.id&&g.remove():Array.from(o).some(({id:E})=>g.id===E)||g.remove()})}o&&o.length&&o.forEach((m,g)=>{const E=document.getElementById(m.id);if(E){const I=E.querySelector(a.filterLists),H=m.querySelector(a.filterLists);if(!I||!H)return;I.innerHTML=H.innerHTML}else{if(g>0){const H=o[g-1].id;document.getElementById(H).after(m);return}m.parentElement&&i.filtersContainer.querySelector(a.filterAccordionItem).before(m)}}),window.themeCore.Accordion.init(".js-filters-container"),i.filterMenuOpener.dataset.count=n?n.dataset.count:0,k({activeFiltersCounter:s,filterPrice:d,pagination:u,selectedFiltersWrapper:e,infiniteScroll:N,loadMoreButton:x}),N&&R(),d&&S()}function S(){const{minInput:t,maxInput:e,rangeInputs:r}=p(l,L),{thumbOffset:n}=r.dataset,s=`calc(${Number(t.value)/Number(t.max)*100}% - ${n}px)`,o=`calc(${Number(e.value)/Number(e.max)*100}% + ${n}px)`;r.style.setProperty(b.rangeMin,s),r.style.setProperty(b.rangeMax,o)}function k(t){var e,r;if(!(!t||!Object.keys(t).length)){for(const n in t)if(i[n]&&(i[n].classList.remove(...i[n].classList),i[n].classList.add(...((e=t[n])==null?void 0:e.classList)||[]),i[n].innerHTML=((r=t[n])==null?void 0:r.innerHTML)||"",t[n]))for(const s in t[n].dataset)i[n].dataset[s]=t[n].dataset[s]}}async function re(t){const e=t.target.closest(a.paginationLink);if(!e)return;t.preventDefault(),w.classList.add(c.active),e.classList.add(c.noEvents),A();let r=ie();const n=new URL(e.href).searchParams.get("type");window.scrollTo(0,r),window.parent===window.top&&window.history.pushState({},null,e.href),await v(e.href),w.classList.remove(c.active);const s=document.querySelector(a.searchTypes),o=document.querySelector(a.searchTypeActiveButton);if(!s||!o)return;s.value=n;let d=document.querySelectorAll(".js-search-types-wrapper .js-pagination-link");d.length&&d.forEach(x=>{x.classList.toggle(f.active,x.getAttribute("data-search-type")===n)});const u=document.querySelector(a.gridWrapper);u&&u.setAttribute("data-type",n)}async function ne(){B({namespace:"filters-template"}).open(),await v(window.location.href),B({namespace:"filters-template"}).close()}function ie(){const e=document.querySelector(a.header).hasAttribute("data-header-sticky")?j():0,r=document.querySelector(a.collectionHeader);if(!r)return 0;const n=window.pageYOffset+r.getBoundingClientRect().top,s=e+10;return n-s}function se(t){const e=t.target.closest(a.priceNumberInput);if(!e)return;const{minInput:r,maxInput:n,minRange:s,maxRange:o}=p(l,L),d=n.value&&r.value&&Number(n.value)<=Number(n.max)&&Number(r.value)>=Number(r.min);if(Number(n.value)-Number(r.value)>=0&&d){e.dataset.type==="min"?s.value=r.value:o.value=n.value,S(),U(r,n);return}e.dataset.type==="min"?r.classList.add(c.error):n.classList.add(c.error)}function oe(t){const e=t.target.closest(a.priceRangeInput);if(!e)return;const{minInput:r,maxInput:n,minRange:s,maxRange:o}=p(l,L);o.value-s.value<0&&(e.dataset.type==="min"?s.value=r.value:o.value=n.value),r.value=s.value,n.value=o.value,U(r,n),S()}function U(...t){t.forEach(e=>e.classList.remove(c.error))}async function ae(t){const e=t.target.closest(a.removeFilterLink);e&&(t.preventDefault(),i.form.classList.add(c.loading),window.parent===window.top&&window.history.pushState({},null,e.href),await v(e.href),i.form.classList.remove(c.loading),window.themeCore.Accordion.setTabIndex(".product-filters__form-accordion","hidden"))}async function ce(t){if(!t.target.closest(a.resetFilters))return;const r=new URL(window.location.href);[...r.searchParams.keys()].filter(s=>s!==C.sort&&s!==C.query).forEach(s=>r.searchParams.delete(s)),i.form.classList.add(c.loading),window.parent===window.top&&window.history.pushState({},null,r),await v(r),i.form.classList.remove(c.loading),window.themeCore.Accordion.setTabIndex(".product-filters__form-accordion","hidden")}async function le(t,e){t.unobserve(e);const r=window.location.origin+e.dataset.nextUrl;w.classList.add(c.active),await _(r),w.classList.remove(c.active)}async function _(t){const e=q(t,l.id),r=await W(e),{gridWrapper:n,infiniteScroll:s,loadMoreButton:o}=p(r,h);i.gridWrapper.insertAdjacentHTML("beforeend",n.innerHTML),k({infiniteScroll:s,loadMoreButton:o}),s&&R(),window.themeCore.LazyLoadImages.init(),window.themeCore.EventBus.emit("compare-products:init")}async function de(t){const e=t.target.closest(a.loadMoreButton);if(!e)return;w.classList.add(c.active),e.classList.add(c.noEvents);const r=window.location.origin+e.dataset.nextUrl;await _(r),w.classList.remove(c.active)}function ue(t){const{filterMenuOpenerWrapper:e,loadMoreButton:r,infiniteScroll:n,filterLists:s,filterPrice:o,pagination:d,form:u}=t;e&&(z.init(),G()),(s||o)&&l.addEventListener("click",ae),o&&S(),l.addEventListener("input",se),l.addEventListener("input",oe),(d||u)&&window.addEventListener("popstate",ne),u&&l.addEventListener("change",X),s&&l.addEventListener("click",ce),(d||l.querySelector(a.paginationLink))&&l.addEventListener("click",re),r&&l.addEventListener("click",de),n&&R()}function pe(){!l||!Object.keys(i).length||ue(i)}return Object.freeze({init:pe})},D=()=>{window.themeCore.utils.registerExternalUtil(fe,"ProductFilters")};window.themeCore&&window.themeCore.loaded?D():document.addEventListener("theme:all:loaded",D,{once:!0});
